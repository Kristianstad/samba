#!/bin/sh
set -e

if [ -n "$2" ]
then
   file="$2"
   rec="-R"
   chmod="-R u=rwX,go="
   
else
   file="$1"
   rec=""
   chmod="u=rwX,go=X"
fi
file=`echo -n "$file" | /usr/bin/tr -dc '[:alnum:]_'`
if [ -e "$file" ]
then
   read sambauser < /root/sambauser
   fileowner="`stat -c '%U' /path/of/file/or/directory`"
   if [ "$fileowner" == "$sambauser" ]
   then
      /bin/chown $rec root "$file"
   fi
   if [ "$fileowner" == "root" ] || [ "$fileowner" == "$sambauser" ]
   then
      /bin/chmod $chmod "$file"
   fi
fi
exit 0
