#!/bin/sh
set -e

if [ -n "$2" ]
then
   file="$2"
   rec="-R"
else
   file="$1"
   rec=""
fi
file="$(echo -n "$file" | /usr/bin/tr -dc '[:alnum:]_/')"
if [ -e "$file" ]
then
   fileowner="`stat -c '%U' $file`"
   if [ "$fileowner" == "$SUDO_USER" ]
   then
      /bin/chown $rec root "$file"
   fi
   if [ "$fileowner" == "root" ] || [ "$fileowner" == "$SUDO_USER" ]
   then
      if [ -z "$rec" ] && [ -d "$file" ]
      then
         chmod="u=rwX,go=X"
      else
         chmod="u=rwX,go="
      fi
      /bin/chmod $chmod "$file"
   fi
fi
exit 0
